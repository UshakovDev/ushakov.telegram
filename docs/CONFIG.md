# Настройка модуля ushakov.telegram

## Основные параметры
- `BOT_TOKEN` - токен бота от @BotFather (формат `123456:AA...`).
- `BOT_USERNAME` - логин бота без `@`.
- `WEBHOOK_PUBLIC_HOST` - публичный домен (для локалки можно оставить пустым и использовать текущий хост).
- `DEFAULT_CHAT_IDS` - дополнительные получатели (список chat_id/@каналов через запятую) для админ‑уведомлений (можно оставить пустым).
- `STAFF_GROUP_IDS` - ID групп Bitrix, которые считаются «сотрудниками».

## События (сотрудники)
Включите нужные чекбоксы: «Новый заказ», «Смена статуса», «Оплата», «Отмена», «Снятие отмены», «Статус отгрузки», «Регистрация пользователя».

## Покупатели
- Включите «Включить уведомления покупателям».
- Выберите события, которые отправлять покупателям.
- Опционально: включите «Показывать кнопку “Привязать Telegram”» - в ЛК появится кнопка и хинт про `/stop`.

## Шаблоны сообщений
Текстовые шаблоны общие для сотрудников и покупателей. Ссылки подставляются автоматически:
- для сотрудников - `#ADMIN_URL#`;
- для покупателей - `#URL#` (личный кабинет).

Переменные подсвечены `#NAME#`. Вставки экранируются (parse_mode=HTML), используйте минимальную разметку.

## Права доступа
Во вкладке «Права доступа» настройте уровни для групп. По умолчанию доступ закрыт (`D`).

## FAQ по настройке
- Вебхук установлен, но сообщений нет - проверьте исходящий HTTPS к `api.telegram.org`.
- Шаблоны «пропадают» - на БД `utf8mb3` избегайте 4‑байтных эмодзи или перейдите на `utf8mb4`.
